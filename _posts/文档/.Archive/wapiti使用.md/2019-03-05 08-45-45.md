---
date: 
tags: 
status: public
title:  wapiti实验
---

 wapiti实验

一、	实验环境配置(Linux or macOS)
1.1	配置虚拟环境
```
conda create -n python3.6 python=3.6 (创建虚拟环境python3.6)
source activate python3.6 (打开虚拟环境)
source deactivate python3.6 (关闭虚拟环境)
Windows系统请参考：https://conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html
```

注: 若conda命令不存在，请自行添加环境变量（Windows）
1.2	Wapiti工具环境配置
```
source activate python3.6
mkdir yourProject (yourProject是自定义的项目名)
cd yourProject
git clone https://github.com/Jekub/Wapiti.git
cd Wapiti
make
make install
./wapiti (有帮助文档输出表示安装成功)
```
注: 若make失败，请安装gcc
1.3	工作环境配置
`二、	数据描述
2.1训练数据
训练数据有100个Drug Label，格式如下面所展示。 
Text:
 
![](./_image/2019-03-02-16-04-28.jpg)

Entity:

![](./_image/2019-03-02-16-04-34.jpg)
 
2.2 测试数据
从DailyMed (https://dailymed.nlm.nih.gov) 中下载药物标签34个，格式为XML。

（已经下载好在2019SpringTextM中）
例： 

![](./_image/2019-03-02-16-04-42.jpg)

 
三、	数据处理
训练数据和测试数据的数据格式均为XML，但不完全相同。在训练模型，和测试前均需要对数据进行预处理。将数据处理成”.tab”格式。
3.1 训练数据预处理
通过以下脚本预处理训练数据。


python tac2brat.py -d train_xml -o outtrain -F TokenDict:diso:dis-DISO.dic -t conll -s OBBEI

-d 训练文件夹 
-o 预处理结果输出文件夹
-F 字典特征
-t 输出格式
-s 标签格式

输出格式：
 

![](./_image/2019-03-02-16-04-53.jpg)

注：同一横行中第一个红框中是分词后的单词，第二个红框是文件名：所属段落：起始位置：单词长度，第三个红框是字典特征，第四个红框是实体标签。在实体标签中对于某类标签如：标签AdverseReaction 。若某个单词 “pruritis” 属于该标签则被标注为”B-AdverseReaction”;若某个词组“injection site hemorrhage”属于该标签，则该词组被标注为“B- AdverseReaction I-AdverseaeAction E-AdverseReaction”。于是，我们将该标签方式称为”BIEO”，此处B-type表示begin, I-type 表示Inside, E-type 表示End, O表示不属于该标签。

3.2 测试数据预处理
通过以下脚本处理测试数据。

cd 工作目录
python to_xml_needed.py 测试文件夹 output (注：在这里测试文件夹是need_drug,表示我们从dailyMed下载的XML药物标签就放在该文件夹中。)
python tac2brat.py -d output  -o outtest -F TokenDict:diso:diso-DISO.dic -t conll -s OBBEI

输出格式：
 
![](./_image/2019-03-02-16-05-08.jpg)

注：格式同训练数据
四、	模型训练
将训练数据随机按找7:3划分，在训练模型过程中，7份用作实际训练模型，3份用作开发集调整参数。当模型最优后用该参数训练所有10份数据获得模型，并对测试数据进行预测。
4.1 调整参数优化模型

sudo bash dev-wapiti.sh

结果打印：

![](./_image/2019-03-02-16-05-19.jpg)

 
	模型被存储在eval/bio中。
4.2 预测测试数据

	sudo bash test_wapiti.sh

 
![](./_image/2019-03-02-16-05-27.jpg)

	
出现Finished!说明序列标注完成。序列标注结果存储在eval/bio/Tok321dis-train-test-outtrain.tab中。
